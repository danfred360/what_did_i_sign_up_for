services:
  reverse-proxy:
    image: traefik:v2.10
    command: 
    - "--api.insecure=true"
    - "--providers.docker=true"
    - "--providers.docker.exposedbydefault=false"
    - "--entrypoints.web.address=:80"
    ports:
      - "80:80"
      - "8080:8080"
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock

  # whoami:
  #   # A container that exposes an API to show its IP address
  #   image: traefik/whoami
  #   labels:
  #     - "traefik.http.routers.whoami.rule=Host(`whoami.docker.localhost`)"
  backend:
    build: ./
    restart: always
    labels:
      - "traefik.enable=true"
      - "traefik.http.routers.backend.rule=Host(`npole.org`)"
      # - "traefik.http.routers.backend.rule=Host(`npole.org`) && PathPrefix(`/docs`)"
      # - "traefik.http.routers.whoami.entrypoints=web"
    # networks:
    #   # Use the public network created to be shared between Traefik and
    #   # any other service that needs to be publicly available with HTTPS
    #   - traefik-public

networks:
  traefik-public:
    external: true